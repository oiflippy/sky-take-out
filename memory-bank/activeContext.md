* [2025-05-09 08:43:45] - Debug Status Update: Investigating `java.sql.SQLException: Data truncated for column 'status' at row 1` when inserting into `employee` table. Java `Employee.status` is `Integer`, value is `1`.
* [2025-05-09 08:45:33] - Debug Status Update: Received `employee` table structure. `status` column is `int` with length `0`. This is suspicious.
* [2025-05-09 08:47:00] - Debug Status Update: Diagnosed that `INT` with length `0` for `status` column is likely causing "Data truncated" error for value `1`. The definition is problematic.
* [2025-05-09 09:19:40] - Debug Status Update: Identified root cause: Incorrect column order in `EmployeeMapper.java` `@Insert` statement. `createTime` was being inserted into `status` column. Applied fix by explicitly naming columns in the SQL.
* [2025-05-09 11:13:15] - Architect Task: Analyzed request to modify `EmployeeServiceImpl.java` to use dynamic user IDs for `createUser` and `updateUser`. Confirmed architectural soundness and logged decision. Next step is likely code implementation.
* [2025-05-09 11:16:30] - Code Task: Modified [`sky-server/src/main/java/com/sky/service/impl/EmployeeServiceImpl.java`](sky-server/src/main/java/com/sky/service/impl/EmployeeServiceImpl.java) to use `BaseContext.getCurrentId()` for `createUser` and `updateUser` fields in the `save` method.
* [2025-05-09 11:29:09] - Code Task: Resolved ThreadLocal cleanup issue in [`sky-server/src/main/java/com/sky/config/JwtAuthenticationTokenFilter.java`](sky-server/src/main/java/com/sky/config/JwtAuthenticationTokenFilter.java) by adding `BaseContext.removeCurrentId()` in a `finally` block.
* [2025-05-09 11:37:06] - Integration Check: Completed. Verified changes in `EmployeeServiceImpl.java` (dynamic user ID) and `JwtAuthenticationTokenFilter.java` (ThreadLocal cleanup). Ensured consistency with documentation and Memory Bank. Corrected a minor comment in `EmployeeServiceImpl.java`. Project is ready for build and runtime testing by the user.
* [2025-05-09 20:41:18] - Architect Task: Analyzed "新增员工" feature based on spec-pseudocode. Understanding its 3-tier architecture (Controller, Service, Mapper), DTO usage, and key component interactions. Preparing to update Memory Bank with these architectural insights.
* [2025-05-09 20:59:04] - Debug Status Update: Fixed `TooManyActualInvocations` error in `EmployeeServiceImplTest.testBatchSaveEmployees` by moving `Mockito.verify` outside the loop and specifying `times(50)`. User opted to keep "男"/"女" for `sex` field in this test.
* [2025-05-09 21:20:05] - 完成了将测试数据初始化逻辑迁移到测试类 `sky-server/src/test/java/com/sky/runner/TestDataInitializerTest.java` 的任务。
* [2025-05-10 11:37:00] - Architect Task: Reviewed "根据id查询员工信息" feature. Confirmed its design aligns with the established 3-tier architecture (Controller-Service-Mapper) and service layer responsibilities (password masking). Specification definition is clear.
* [2025-05-10 11:49:20] - Code Task: Implemented "根据id查询员工信息" feature. Added `getById` methods to `EmployeeController`, `EmployeeService`, `EmployeeServiceImpl`, and `EmployeeMapper`.
* [2025-05-10 13:55:00] - Architect Task: Analyzed employee update (`/admin/employee`) username uniqueness validation. Confirmed `spec-pseudocode`'s finding: current implementation in [`EmployeeServiceImpl.update`](sky-server/src/main/java/com/sky/service/impl/EmployeeServiceImpl.java:143) lacks logic to exclude the current employee's ID during username uniqueness checks. This is the likely cause of the "'testuser15'已存在" error. Existing architecture (3-tier, MyBatis) is suitable for implementing the fix. Decision logged to enhance validation. Next steps involve code modification in Service and Mapper layers.
* [2025-05-10 14:42:50] - Code Task: Completed fix for `/admin/employee` update username uniqueness. Added `getByUsernameAndNotId` to [`EmployeeMapper.java`](sky-server/src/main/java/com/sky/mapper/EmployeeMapper.java) and [`EmployeeMapper.xml`](sky-server/src/main/resources/mapper/EmployeeMapper.xml). Modified `update` method in [`EmployeeServiceImpl.java`](sky-server/src/main/java/com/sky/service/impl/EmployeeServiceImpl.java) to include new validation logic, using `MessageConstant.ALREADY_EXISTS` for error reporting.
* [2025-05-10 16:07:40] - Architect Task: Reviewing execution plan and pseudocode for "分类管理" (Category Management - Chapter 5.2). Updating Memory Bank with architectural design, component relationships, and context.
* [2025-05-10 16:09:05] - Code Task: Created new file [`sky-server/src/main/java/com/sky/mapper/DishMapper.java`](sky-server/src/main/java/com/sky/mapper/DishMapper.java) with method `countByCategoryId` to count dishes by category ID. This is part of the "分类管理" (Category Management) feature.
* [2025-05-10 16:10:50] - Code Task: Created new file [`sky-server/src/main/java/com/sky/mapper/SetmealMapper.java`](sky-server/src/main/java/com/sky/mapper/SetmealMapper.java) with method `countByCategoryId` to count setmeals by category ID. This is part of the "分类管理" (Category Management) feature.
* [2025-05-10 16:13:06] - Code Task: Created/Updated file [`sky-server/src/main/java/com/sky/mapper/CategoryMapper.java`](sky-server/src/main/java/com/sky/mapper/CategoryMapper.java) based on provided pseudocode and existing content. This is part of the "分类管理" (Category Management) feature.
* [2025-05-10 16:15:07] - Code Task: Created new file [`sky-server/src/main/resources/mapper/CategoryMapper.xml`](sky-server/src/main/resources/mapper/CategoryMapper.xml) based on provided pseudocode. This is part of the "分类管理" (Category Management) feature.
* [2025-05-10 16:17:01] - Code Task: Created/Updated file [`sky-server/src/main/java/com/sky/service/CategoryService.java`](sky-server/src/main/java/com/sky/service/CategoryService.java) based on provided pseudocode and reference content. This is part of the "分类管理" (Category Management) feature.
* [2025-05-10 16:19:36] - Code Task: Created file [`sky-server/src/main/java/com/sky/service/impl/CategoryServiceImpl.java`](sky-server/src/main/java/com/sky/service/impl/CategoryServiceImpl.java) based on provided pseudocode and reference content. This is part of the "分类管理" (Category Management) feature.
* [2025-05-10 16:23:33] - Code Task: Created file [`sky-server/src/main/java/com/sky/controller/admin/CategoryController.java`](sky-server/src/main/java/com/sky/controller/admin/CategoryController.java) based on provided pseudocode and reference content. This is part of the "分类管理" (Category Management) feature.